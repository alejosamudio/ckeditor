(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))d(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function d(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();console.info("[CKEditorBridge] Bootstrap starting",{embedded:window.parent!==window,href:window.location?.href,userAgent:navigator.userAgent});const i=(()=>{const t="CKE_BUBBLE_BRIDGE_V1",n="1.0.0",s=typeof window.location?.search=="string"?window.location.search:"",d=new URLSearchParams(s);let r=!1;try{r=window.localStorage?.getItem("ckeBridgeDebug")==="true"}catch{r=!1}let a=d.get("debug")==="1"||d.get("debug")==="true"||r||window.CKEDITOR_BRIDGE_DEBUG===!0;const l="[CKEditorBridge]",m=window.parent!==window;let u=!m,p=m?"*":window.origin;const w=new Set;let f=null,C=0;const U=20,R=[],k=[],_=[],y=new Map;let I=null;m?(w.add(window.parent),window.top&&window.top!==window&&window.top!==window.parent&&w.add(window.top)):w.add(window);const O={BRIDGE_ID:t,VERSION:n,get DEBUG(){return a},isEmbedded:m};function E(...e){a&&console.log(l,...e)}function B(e){!e||typeof e.postMessage!="function"||w.add(e)}function H(e){a=!!e;try{window.localStorage?.setItem("ckeBridgeDebug",a?"true":"false")}catch{}a?console.log(l,"Debug mode enabled"):console.log(l,"Debug mode disabled")}function v(e,o={},c={}){return{bridge:t,version:n,type:e,payload:o,direction:c.direction||"editor->parent",timestamp:Date.now(),requestId:c.requestId??null,messageId:c.messageId||`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}}function L(e){const o=p||"*";w.forEach(c=>{try{c.postMessage(e,o)}catch(h){console.error(l,"Failed to postMessage to target",h)}}),E("Sent message",e,"→",o,"targets:",w.size)}function D(){if(u)for(;R.length;)L(R.shift())}function T(e,o={},c={}){const h=v(e,o,c);u||e==="EDITOR_READY"?L(h):(E("Queueing message until parent is ready",h),R.push(h))}function K(){if(!m){E("Not embedded in an iframe. Parent communication disabled."),u=!0,D();return}if(f)return;C=0;const e=()=>{C+=1,T("EDITOR_READY",{attempt:C,isEmbedded:m,userAgent:navigator.userAgent}),!a&&C===1&&console.info(`${l} EDITOR_READY #${C} → parent`,{attempt:C,isEmbedded:m,targetOrigin:p})};e(),f=window.setInterval(()=>{if(u){window.clearInterval(f),f=null;return}if(C>=U){window.clearInterval(f),f=null,E("No handshake acknowledgement received. Proceeding with wildcard origin."),u=!0,D();return}e()},500)}function S(e){e&&e!=="null"&&(p=e,E("Target origin updated to",p))}function M(e,o={}){if(u)p==="*"&&e&&e!=="null"&&S(e);else for(u=!0,o&&o.targetOrigin?p=o.targetOrigin:S(e),f&&(window.clearInterval(f),f=null),E("Handshake completed with parent."),D(),T("EDITOR_READY_ACK",{receivedAt:Date.now()});_.length;){const c=_.shift();try{c({origin:p})}catch(h){console.error(l,"Parent ready callback failed",h)}}}function F(e){I?e(I):k.push(e)}function W(e){for(I=e;k.length;){const o=k.shift();try{o(I)}catch(c){console.error(l,"Deferred editor action failed",c)}}}function G(e){typeof e=="function"&&(u?e({origin:p}):_.push(e))}function Y(e,o){typeof o=="function"&&y.set(e,o)}return window.addEventListener("message",e=>{const o=e.data;if(!o||o.bridge!==t||(m&&e.source&&!w.has(e.source)&&(B(e.source),E("Registered new parent candidate from message source")),o.direction&&o.direction!=="parent->editor"))return;E("Received message",o,"from",e.origin),!u||o.type==="PARENT_READY"?M(e.origin,o.payload||{}):p==="*"&&e.origin&&e.origin!=="null"&&S(e.origin);const c=y.get(o.type);if(c)try{c({payload:o.payload||{},requestId:o.requestId??null,event:e,send:T})}catch(h){console.error(l,`Error handling message ${o.type}`,h),T("HANDLER_ERROR",{type:o.type,message:h?.message||"Unknown handler error"})}else o.type!=="PARENT_READY"&&E("No handler registered for type",o.type)}),{send:T,startHandshake:K,setEditor:W,withEditor:F,onParentReady:G,registerHandler:Y,setDebug:H,constants:O}})();window.CKEDITOR_BUBBLE_BRIDGE=i;window.addEventListener("error",t=>{const n=t?.error?.message||t?.message||"Unknown error";console.error("[CKEditorBridge] Uncaught error",t?.error||t);try{i.send("EDITOR_ERROR",{message:n,stack:t?.error?.stack||null,timestamp:Date.now(),phase:"window-error"})}catch{}});window.addEventListener("unhandledrejection",t=>{const n=t?.reason?.message||t?.reason||"Unhandled promise rejection";console.error("[CKEditorBridge] Unhandled promise rejection",t?.reason||t);try{i.send("EDITOR_ERROR",{message:n,stack:t?.reason?.stack||null,timestamp:Date.now(),phase:"unhandled-rejection"})}catch{}});i.startHandshake();let N=!1;function P(t,{ackType:n,requestId:s,reason:d,focus:r}={}){i.withEditor(a=>{N=!0;let l=!1,m=null;try{a.setData(typeof t=="string"?t:""),r&&a.editing.view.focus(),l=!0}catch(u){m=u?.message||"Unknown error applying editor content.",console.error("[CKEditorBridge] Failed to apply content from parent",u),i.send("CONTENT_ERROR",{requestId:s,reason:d,message:m,timestamp:Date.now()})}window.setTimeout(()=>{N=!1,n&&i.send(n,{requestId:s,status:l?"ok":"error",reason:d,message:m,timestamp:Date.now()}),l&&i.send("CONTENT_SYNC",{requestId:s,html:a.getData(),reason:d,timestamp:Date.now()})},0)})}i.registerHandler("INIT",({payload:t,requestId:n})=>{P(t?.html??"",{ackType:"INIT_ACK",requestId:n,reason:"init",focus:t?.focus===!0})});i.registerHandler("SET_CONTENT",({payload:t,requestId:n})=>{P(t?.html??"",{ackType:"SET_CONTENT_ACK",requestId:n,reason:t?.reason||"set-content",focus:t?.focus===!0})});i.registerHandler("CLEAR_CONTENT",({requestId:t})=>{P("",{ackType:"CLEAR_CONTENT_ACK",requestId:t,reason:"clear-content"})});i.registerHandler("REQUEST_CONTENT",({requestId:t})=>{i.withEditor(n=>{i.send("CONTENT_SYNC",{requestId:t,html:n.getData(),reason:"requested-sync",timestamp:Date.now()})})});i.registerHandler("PING",({requestId:t,payload:n})=>{i.send("PONG",{requestId:t,echo:n?.echo??null,timestamp:Date.now()})});i.registerHandler("SET_DEBUG",({payload:t,requestId:n})=>{const s=typeof t?.enabled=="boolean"?t.enabled:!i.constants.DEBUG;i.setDebug(s),i.send("SET_DEBUG_ACK",{requestId:n,status:"ok",enabled:i.constants.DEBUG,timestamp:Date.now()})});const $="eyJhbGciOiJFUzI1NiJ9.eyJleHAiOjE3NjQyMDE1OTksImp0aSI6ImNiMWJiNTk0LWIxODEtNGJmMi1iZTA5LTM2ZGM1MjY3MzIxZiIsInVzYWdlRW5kcG9pbnQiOiJodHRwczovL3Byb3h5LWV2ZW50LmNrZWRpdG9yLmNvbSIsImRpc3RyaWJ1dGlvbkNoYW5uZWwiOlsiY2xvdWQiLCJkcnVwYWwiLCJzaCJdLCJ3aGl0ZUxhYmVsIjp0cnVlLCJsaWNlbnNlVHlwZSI6InRyaWFsIiwiZmVhdHVyZXMiOlsiKiJdLCJ2YyI6ImFhNmQ1YmUwIn0.a4QCfokW3f4OX2Td4j7I5Nv6J9NsaWg4atvrEmD90ijhttvsbqFMfaoJ4a-X_V0ZJ0mxSN6mMf1jjWLJGlV0dQ",X="<YOUR_DOCUMENT_ID>",ee="https://uplnolydjmzr.cke-cs.com/token/dev/9dcdd882883e3315126ce6f9865e9ec42fa58287442ece2a12be481798c5?limit=10",te="wss://uplnolydjmzr.cke-cs.com/ws";let b=0;const ne=40,oe=250;function z(){const t=window.CKEDITOR,n=window.CKEDITOR_PREMIUM_FEATURES;if(t&&n){ie(t,n);return}if(b+=1,(b===1||b%10===0)&&console.warn("[CKEditorBridge] Waiting for CKEditor globals to load...",{attempt:b}),b>=ne){const s="CKEditor UMD bundles did not load in time.";console.error("[CKEditorBridge]",s),i.send("EDITOR_ERROR",{message:s,timestamp:Date.now()});return}window.setTimeout(z,oe)}function ie(t,n){const{AccessibilityHelp:s,Alignment:d,Autoformat:r,AutoImage:a,AutoLink:l,Autosave:m,BalloonToolbar:u,BlockQuote:p,Bold:w,Bookmark:f,CKBox:C,CKBoxImageEdit:U,CKFinder:R,CloudServices:k,Code:_,CodeBlock:y,Comments:I,DecoupledEditor:O,DocumentOutline:E,Emoji:B,Enter:H,Essentials:v,FindAndReplace:L,FontBackgroundColor:D,FontColor:T,FontFamily:K,FontSize:S,FormatPainter:M,GeneralHtmlSupport:F,Heading:W,Highlight:G,HorizontalLine:Y,HtmlComment:e,HtmlEmbed:o,HtmlSupport:c,Image:h,ImageBlock:re,ImageCaption:ae,ImageInline:se,ImageInsert:le,ImageInsertViaUrl:de,ImageResize:ce,ImageStyle:me,ImageToolbar:ue,ImageUpload:ge,Indent:he,IndentBlock:pe,Italic:x,LineHeight:fe,Link:Ee,LinkImage:we,LinkImageEditing:Ce,List:j,ListProperties:Te,Markdown:Ie,MediaEmbed:be,Mention:Q,PageBreak:Re,Paragraph:ke,PasteFromMarkdownExperimental:_e,PasteFromOffice:De,PictureEditing:Se,PresenceList:ye,RealTimeCollaborativeComments:Oe,RealTimeCollaborativeEditing:Le,RealTimeCollaborativeTrackChanges:Ne,RemoveFormat:Ae,SlashCommand:Pe,SpecialCharacters:Ue,SpecialCharactersArrows:Be,SpecialCharactersCurrency:He,SpecialCharactersEssentials:ve,SpecialCharactersLatin:Ke,SpecialCharactersMathematical:Me,SpecialCharactersText:Fe,Strikethrough:We,Style:Ge,Subscript:Ye,Superscript:Ve,Table:Je,TableCaption:ze,TableCellProperties:xe,TableColumnResize:je,TableProperties:Qe,TableToolbar:Ze,TextTransformation:qe,TodoList:$e,TrackChanges:Xe,TrackChangesData:et,TrackChangesPreview:tt,Underline:nt}=t,{AIChat:ot,AIEditorIntegration:it,AIQuickActions:rt,AIReviewMode:at,PasteFromOfficeEnhanced:st,FormatPainter:lt,LineHeight:dt,RealTimeCollaborativeComments:ct,RealTimeCollaborativeEditing:mt,PresenceList:ut,Comments:gt,RealTimeCollaborativeTrackChanges:ht,TrackChanges:pt,TrackChangesData:ft,TrackChangesPreview:Et,SlashCommand:wt}=n,V={autosave:{waitingTime:5e3,save(){}},toolbar:{items:["undo","redo","|","trackChanges","comment","commentsArchive","|","toggleAi","aiQuickActions","|","formatPainter","findAndReplace","|","heading","style","fontSize","fontFamily","lineHeight","fontColor","fontBackgroundColor","|","bold","italic","underline","strikethrough","subscript","superscript","code","removeFormat","|","link","blockQuote","insertTable","insertImage","mediaEmbed","horizontalLine","specialCharacters","codeBlock","|","bulletedList","numberedList","todoList","|","outdent","indent","|","alignment"],shouldNotGroupWhenFull:!0},ai:{container:{type:"overlay",side:"right"},chat:{models:{},context:{document:{enabled:!0},urls:{enabled:!0},files:{enabled:!0}}}},balloonToolbar:["comment","|","aiQuickActions","|","bold","italic","|","link","insertImage","|","bulletedList","numberedList"],cloudServices:{tokenUrl:ee,webSocketUrl:te},collaboration:{channelId:X},comments:{editorConfig:{extraPlugins:[r,w,x,j,Q],mention:{feeds:[{marker:"@",feed:[]}]}}},fontFamily:{supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},image:{toolbar:["toggleImageCaption","|","imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight","|","resizeImage","|","ckboxImageEdit"],styles:{options:["alignBlockLeft","block","alignBlockRight"]}},initialData:"<p>Start writing...</p>",licenseKey:$,lineHeight:{supportAllValues:!0},link:{addTargetToExternalLinks:!0,defaultProtocol:"https://",decorators:{toggleDownloadable:{mode:"manual",label:"Downloadable",attributes:{download:"file"}}}},list:{properties:{styles:!0,startIndex:!0,reversed:!0}},mention:{feeds:[{marker:"@",feed:[]}]},placeholder:"Type or paste your content here!",presenceList:{container:document.querySelector("#editor-presence")},sidebar:{container:document.querySelector("#editor-annotations")},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableProperties","tableCellProperties"]}};A(V);const Z=250;O.create(document.querySelector("#editor"),V).then(g=>{document.querySelector("#editor-toolbar").appendChild(g.ui.view.toolbar.element),document.querySelector("#editor-menu-bar").appendChild(g.ui.view.menuBarView.element),window.editor=g,i.setEditor(g);let J;return g.model.document.on("change:data",()=>{N||(window.clearTimeout(J),J=window.setTimeout(()=>{const q=g.getData();i.send("CONTENT_CHANGE",{html:q,reason:"user-input",timestamp:Date.now()})},Z))}),i.onParentReady(()=>{i.send("CONTENT_SYNC",{html:g.getData(),reason:"initial-sync",timestamp:Date.now()})}),i.startHandshake(),g}).catch(g=>{console.error(g),i.send("EDITOR_ERROR",{message:g?.message||"Failed to initialize CKEditor.",stack:g?.stack||null,timestamp:Date.now()})})}z();function A(t){if(A.configUpdateAlertShown)return;const n=(d,r)=>d!==r&&d!==void 0,s=[];A.configUpdateAlertShown=!0,n(t.licenseKey,"<YOUR_LICENSE_KEY>")||s.push("LICENSE_KEY"),n(t.cloudServices?.tokenUrl,"<YOUR_CLOUD_SERVICES_TOKEN_URL>")||s.push("CLOUD_SERVICES_TOKEN_URL"),n(t.cloudServices?.webSocketUrl,"<YOUR_CLOUD_SERVICES_WEBSOCKET_URL>")||s.push("CLOUD_SERVICES_WEBSOCKET_URL"),s.length&&window.alert(["Please update the following values in your editor config","to receive full access to Premium Features:","",...s.map(d=>` - ${d}`)].join(`
`))}
